!function(e){e.fn.mason=function(t,r){var o={itemSelector:null,ratio:0,sizes:[],columns:[[0,480,1],[480,780,2],[780,1080,3],[1080,1320,4],[1320,1680,5]],promoted:[],filler:{itemSelector:t.itemSelector,filler_class:"mason_filler"},randomSizes:!1,randomFillers:!1,layout:"none",gutter:0};if(r)var l={complete:r};var i={block:{height:0,width:0},matrix:[]};return this.each(function(){function a(){m.children(".mason_clear").length<1&&m.append("<div class='mason_clear' style='clear:both;position:relative;'></div>"),i.block.height=parseFloat((m.width()/s()/h.ratio).toFixed(0)),i.block.width=parseFloat(m.width()/s()),n()}function n(){var t=s();if(1==t)$sel=m.children(h.itemSelector),$sel.height(i.block.height),$sel.width(i.block.width),$sel.css({margin:"0px"});else{for(var r=0;r<h.promoted.length;r++)h.sizes.push([h.promoted[r][0],h.promoted[r][1]]);m.children(h.itemSelector).each(function(){$sel=e(this);var t;h.randomSizes?t=Math.floor(Math.random()*(h.sizes.length-h.promoted.length)):(t=$sel.data("layout"),"undefined"==typeof t&&(t=Math.floor(Math.random()*(h.sizes.length-h.promoted.length)))),ranSize=h.sizes[t];for(var r=0;r<h.promoted.length;r++)$sel.hasClass(h.promoted[r][2])&&(ranSize=[h.promoted[r][0],h.promoted[r][1]],t=h.sizes.length-h.promoted.length+r);$sel.data("size",t);var o=parseFloat((i.block.height*ranSize[1]).toFixed(2));o-=2*h.gutter;var l=parseFloat(i.block.width*ranSize[0]);l-=2*h.gutter,$sel.height(o+"px"),$sel.width(l+"px"),$sel.css({margin:h.gutter})});var o=m.height(),l=o/i.block.height;i.matrix=[];for(var r=0;l>r;r++){i.matrix[r]=[];for(var a=0;t>a;a++)i.matrix[r][a]=!1}m.children(h.itemSelector).each(function(){$sel=e(this);for(var t=Math.round($sel.position().left/i.block.width),r=Math.round($sel.position().top/i.block.height),o=parseFloat($sel.data("size")),l=h.sizes[o][1],a=h.sizes[o][0],n=l*a,s=0;n>s;s++)for(var c=0;l>c;c++){i.matrix[r+c][t]=!0;for(var m=0;a>m;m++)i.matrix[r+c][t+m]=!0}});for(var n=e(h.filler.itemSelector).length,r=0;r<i.matrix.length;r++)for(var a=0;a<i.matrix[r].length;a++)if(0==i.matrix[r][a]){var d,f,u=parseFloat(i.block.height),p=parseFloat(i.block.width),g=parseFloat((r*u).toFixed(2))+h.gutter,v=parseFloat(a*p)+h.gutter;u-=2*h.gutter,p-=2*h.gutter,d=h.randomFillers?Math.floor(Math.random()*e(h.filler.itemSelector).length):n-1,f=e(h.filler.itemSelector).eq(d).clone(),f.addClass(h.filler.filler_class),f.css({position:"absolute",top:g+"px",left:v+"px",height:u+"px",width:p+"px",margin:"0px"}),f.appendTo(m)}null!=c.complete&&c.complete()}}function s(){var e=Math.floor(m.width()),t=0,r=h.columns.length-1;if(e>=h.columns[r][1])t=h.columns[r][2];else for(var o=0;r>=o;o++)e>h.columns[o][0]&&e<h.columns[o][1]&&(t=h.columns[o][2]);return t}var h,c,m;h=e.extend(o,t),c=e.extend(l,r),m=e(this);var d=function(){var e={};return function(t,r,o){o||(o=f()),e[o]&&clearTimeout(e[o]),e[o]=setTimeout(t,r)}}(),f=function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;5>r;r++)e+=t.charAt(Math.floor(Math.random()*t.length));return e};"fluid"==h.layout&&e(window).resize(function(){e("."+h.filler.filler_class).remove(),i.matrix=[],d(function(){e("."+h.filler.filler_class).remove(),a()},150)}),a()})}}(jQuery);